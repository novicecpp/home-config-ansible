- name: install kubectl
  tags: kubectl
  get_url:
    url: https://dl.k8s.io/release/v1.19.12/bin/linux/amd64/kubectl
    dest: ~/.local/bin
    mode: '0755'

- name: ensure user bash_completion.d dir
  file:
    path: ~/.bash_completion.d
    state: directory

- name: export kubectl bash completion
  command: bash -c 'kubectl completion bash > ~/.bash_completion.d/kubectl.bash'

- name: install kubelogin
  include_role:
    name: download_and_extract
  vars:
    download_url: https://github.com/int128/kubelogin/releases/download/v1.22.1/kubelogin_linux_amd64.zip
    checksum: sha256:dfbc8a6535178f58c2d96bd8d1061d4688de8c83eb1cae9d0db687224ebc6726
    from_path: kubelogin
    to_path: ~/.local/bin/kubectl-oidc_login
